<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game - ExamRush</title>
    <link rel="stylesheet" href="../css/game.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/home.css">
    <script src="../js/main.js" defer></script>
</head>
<body>
<header>
    <nav>
        <ul style="display: flex; align-items: center; padding: 0; margin: 0;">
            <li style="margin-right: auto; list-style: none;">
                <a href="deck.html" style="font-size: 24px; text-decoration: none; padding: 10px;">â¬…</a>
            </li>
        </ul>
    </nav>
</header>


<main>
    <button id="start-turn"><img id="profile-img" src="../images/pick-card.png" alt="Immagine Profilo"></button>
    <div id="quiz-container" style="display: none;">
        <p id="question-text"></p>
        <div id="answers-container"></div>
        <p id="timer">Tempo rimanente: 30s</p>
    </div>
    <p id="score">Punteggio: 0</p>
</main>
<script>
    const quizDataJSON = Android.getDeck();
    const quizData = JSON.parse(quizDataJSON);

    const totalTurns = Math.floor(quizData.cards.length * 0.66);
    let currentTurn = 0;
    let score = 0;
    let timer;
    let timeLeft = 30;

    const startButton = document.getElementById('start-turn');
    const quizContainer = document.getElementById('quiz-container');
    const questionText = document.getElementById('question-text');
    const answersContainer = document.getElementById('answers-container');
    const timerDisplay = document.getElementById('timer');
    const scoreDisplay = document.getElementById('score');

    function startTurn() {
        if (currentTurn >= totalTurns) {
            alert(`Quiz finito! Punteggio finale: ${score}`);
            return;
        }

        currentTurn++;
        startButton.style.display = 'none';
        quizContainer.style.display = 'block';
        loadQuestion();
    }

    function loadQuestion() {
        const randomIndex = Math.floor(Math.random() * quizData.cards.length);
        const questionData = quizData.cards[randomIndex];

        questionText.textContent = questionData.question;
        answersContainer.innerHTML = '';

        questionData.answers.forEach(answer => {
            const button = document.createElement('button');
            button.textContent = answer;
            button.onclick = () => checkAnswer(answer, questionData.correct_answer);
            answersContainer.appendChild(button);
        });

        startTimer();
    }

    function startTimer() {
        timeLeft = 30;
        timerDisplay.textContent = `Tempo rimanente: ${timeLeft}s`;
        timer = setInterval(() => {
            timeLeft--;
            timerDisplay.textContent = `Tempo rimanente: ${timeLeft}s`;

            if (timeLeft === 0) {
                clearInterval(timer);
                nextTurn();
            }
        }, 1000);
    }

    function checkAnswer(selected, correct) {
        clearInterval(timer);
        if (selected === correct) {
            score++;
            scoreDisplay.textContent = `Punteggio: ${score}`;
        }
        nextTurn();
    }

    function nextTurn() {
        quizContainer.style.display = 'none';
        startButton.style.display = 'inline';
    }

    startButton.addEventListener('click', startTurn);
</script>
</body>
</html>
